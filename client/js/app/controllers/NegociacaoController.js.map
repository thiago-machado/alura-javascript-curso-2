{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["NegociacaoController","_ordemAtual","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","Bind","ListaNegociacoes","NegociacoesView","_mensagem","Mensagem","MensagemView","_service","NegociacaoService","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","texto","erro","setInterval","importaNegociacoes","event","preventDefault","_criaNegociacao","cadastra","mensagem","_limpaFormulario","coluna","inverteOrdem","ordena","a","b","Negociacao","DateHelper","textoParaData","value","parseInt","parseFloat","focus","apaga","esvazia","importa"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["class NegociacaoController {\r\n\r\n  constructor() {\r\n\r\n    this._ordemAtual = '';\r\n    let $ = document.querySelector.bind(document);\r\n    this._inputData = $('#data');\r\n    this._inputQuantidade =  $('#quantidade');\r\n    this._inputValor = $('#valor');\r\n\r\n    this._listaNegociacoes = new Bind(\r\n      new ListaNegociacoes(),\r\n      new NegociacoesView($('#negociacoesView')),\r\n      'adiciona', 'esvazia', 'ordena', 'inverteOrdem');\r\n\r\n    this._mensagem = new Bind(\r\n      new Mensagem(),\r\n      new MensagemView($('#mensagemView')),\r\n      'texto');\r\n\r\n    this._service = new NegociacaoService();\r\n\r\n    this._init();\r\n  }\r\n\r\n  _init() {\r\n    this._service\r\n      .lista()\r\n      .then(negociacoes =>\r\n        negociacoes.forEach(negociacao => this._listaNegociacoes.adiciona(negociacao)))\r\n      .catch(erro => this._mensagem.texto = erro);\r\n\r\n      setInterval(() => { this.importaNegociacoes() }, 5000);\r\n  }\r\n\r\n  adiciona(event) {\r\n    event.preventDefault();\r\n\r\n    let negociacao = this._criaNegociacao();\r\n    this._service\r\n      .cadastra(negociacao)\r\n      .then(mensagem => {\r\n        this._listaNegociacoes.adiciona(negociacao);\r\n        this._mensagem.texto = mensagem;\r\n        this._limpaFormulario();\r\n      })\r\n      .catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  ordena(coluna) {\r\n    /*\r\n    Ordenando as colunas da tabela quando clicadas.\r\n    Podemos acessar o atributo de um objeto usando colchetes.\r\n    Quando fazemos a[coluna], na verdade, estamos querendo acessar algum atriburo do objeto.\r\n    Se por acaso, coluna for \"data\", então estaríamos acessando a propriedade \"data\" do objeto \"a\".\r\n    */\r\n    if(this._ordemAtual == coluna) {\r\n      this._listaNegociacoes.inverteOrdem();\r\n    } else {\r\n      this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\r\n    }\r\n    this._ordemAtual = coluna;\r\n  }\r\n\r\n  _criaNegociacao() {\r\n    return new Negociacao(\r\n      DateHelper.textoParaData(this._inputData.value),\r\n      parseInt(this._inputQuantidade.value),\r\n      parseFloat(this._inputValor.value)\r\n    );\r\n  }\r\n\r\n  // Criar um método começando com underline, indica que é um método privado e que deveria ser\r\n  // acessado somente por essa classe\r\n  _limpaFormulario() {\r\n    this._inputData.value = '';\r\n    this._inputQuantidade.value = 1;\r\n    this._inputValor.value = 0.0\r\n    this._inputData.focus();\r\n  }\r\n\r\n  // Limpa a tabela caso o usuário clique no botão Apagar\r\n  apaga() {\r\n\r\n    this._service\r\n      .apaga()\r\n      .then(mensagem => {\r\n          this._mensagem.texto = mensagem;\r\n          this._listaNegociacoes.esvazia();\r\n      })\r\n      .catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  importaNegociacoes() {\r\n    /*\r\n    Esse método antes era dessa maneira como está comentado.\r\n    Mas o professor resolver colocar todo esse código dentro de NegociacaoService,\r\n    com leves alterações. E essa alteração não foi mostrada em aula.\r\n    */\r\n    /*Promise.all([\r\n      service.obterNegociacoesDaSemana(),\r\n      service.obterNegociacoesDaSemanaAnterior(),\r\n      service.obterNegociacoesDaSemanaRetrasada()]\r\n    ).then(negociacoes => {\r\n      negociacoes\r\n      .reduce((arrayAchatado, array) => arrayAchatado.concat(array), [])\r\n      .forEach(negociacao => this._listaNegociacoes.adiciona(negociacao));\r\n      this._mensagem.texto = 'Negociações importadas com sucesso';\r\n    })\r\n    .catch(erro => this._mensagem.texto = erro);*/\r\n\r\n    this._service\r\n        .importa(this._listaNegociacoes.negociacoes)\r\n        .then(negociacoes => negociacoes.forEach(negociacao => {\r\n            this._listaNegociacoes.adiciona(negociacao);\r\n            this._mensagem.texto = 'Negociações importadas'\r\n        }))\r\n        .catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n\r\n\r\n}\r\n"]}